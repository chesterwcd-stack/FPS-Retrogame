<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Corporate Ladder</title>

  <!-- Tailwind (CDN; fine for quick deploys) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Three.js + helpers -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/WebGL.js"></script>

  <!-- Tone.js (audio) -->
  <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.min.js"></script>

  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #0f2a14; /* deep green */
      color: #e8f5ec;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      overflow: hidden;
    }
    #gameContainer {
      position: relative;
      width: 100%;
      height: 100%;
    }
    #overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(2px);
      z-index: 10;
    }
    #status {
      position: absolute;
      left: 12px;
      bottom: 10px;
      font-size: 12px;
      opacity: .9;
      z-index: 20;
    }
    canvas { display: block; outline: none; }
  </style>
</head>
<body>
  <div id="gameContainer">
    <!-- Start overlay -->
    <div id="overlay">
      <div class="bg-green-900/80 rounded-xl shadow-xl p-6 w-[90vw] max-w-[640px] text-center border border-green-600">
        <h1 class="text-2xl font-bold tracking-wide mb-2">CORPORATE LADDER</h1>
        <p class="text-sm opacity-90 mb-5">Climb the ladder. Stomp on meetings. Collect your salary. Don’t burnout.</p>
        <button id="start-button"
          class="px-4 py-2 rounded-lg bg-emerald-500 hover:bg-emerald-400 active:scale-[.98] text-black font-semibold transition">
          Start Game
        </button>
        <p id="status-message" class="text-xs mt-3 opacity-80">Audio will start after you click “Start Game”.</p>
      </div>
    </div>

    <!-- Status (bottom-left) -->
    <div id="status" class="text-emerald-200"></div>
  </div>

  <script>
    /**************
     * Firebase (optional)
     * If you don't have Firebase yet, leave this as null and the game will run without online scores.
     **************/
    const firebaseConfig = null; // <-- paste your Firebase config object here later

    async function initializeFirebase() {
      if (!firebaseConfig) {
        setStatus("Running without online high scores (no Firebase config).");
        gameInitialized = true;
        initGame();
        return;
      }
      try {
        // Example (uncomment if you add Firebase SDKs):
        // const app = firebase.initializeApp(firebaseConfig);
        // const db  = firebase.firestore();
        setStatus("Firebase connected.");
      } catch (e) {
        setStatus("Firebase not available. Running offline.");
      } finally {
        gameInitialized = true;
        initGame();
      }
    }

    /**************
     * Globals
     **************/
    let gameInitialized = false;
    let scene, camera, renderer, controls, cube, clock;

    const container = document.getElementById('gameContainer');
    const overlay   = document.getElementById('overlay');
    const startBtn  = document.getElementById('start-button');
    const statusEl  = document.getElementById('status');
    const note      = document.getElementById('status-message');

    function setStatus(msg) {
      if (statusEl) statusEl.textContent = msg || "";
    }

    /**************
     * User-gesture start:
     * 1) Start Tone.js audio
     * 2) Lock pointer on the canvas
     * 3) Hide overlay and kick off the loop
     **************/
    startBtn.addEventListener('click', async () => {
      try { if (typeof Tone !== 'undefined') await Tone.start(); } catch {}
      note.textContent = "Audio started.";

      // If controls are ready, request lock
      if (controls) controls.lock();

      overlay.style.display = 'none';
      // play a tiny blip to confirm audio works (optional)
      try {
        const synth = new Tone.Synth().toDestination();
        synth.triggerAttackRelease("C5", "8n");
      } catch {}
    });

    /**************
     * Game init (Three.js + Pointer Lock on canvas)
     **************/
    function initGame() {
      // WebGL check
      if (!WEBGL.isWebGLAvailable()) {
        note.textContent = "WebGL isn't available. Try Chrome/Edge with hardware acceleration.";
        overlay.style.display = 'grid';
        return;
      }

      clock = new THREE.Clock();

      // Scene & Camera
      scene  = new THREE.Scene();
      scene.background = new THREE.Color(0x0b1f12);
      camera = new THREE.PerspectiveCamera(70, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.set(0, 1.6, 4);

      // Renderer (attach canvas to container)
      renderer = new THREE.WebGLRenderer({
        antialias: true,
        alpha: true,
        powerPreference: 'high-performance',
      });
      renderer.setSize(container.clientWidth, container.clientHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      container.appendChild(renderer.domElement);

      // Pointer Lock controls bound to the canvas (not document.body)
      controls = new THREE.PointerLockControls(camera, renderer.domElement);

      // Basic scene content (replace with your actual game world)
      const light = new THREE.DirectionalLight(0xffffff, 1.0);
      light.position.set(3, 5, 2);
      scene.add(light, new THREE.AmbientLight(0xffffff, 0.15));

      const geo = new THREE.BoxGeometry(1,1,1);
      const mat = new THREE.MeshStandardMaterial({ color: 0x27ae60, roughness: 0.4, metalness: 0.1 });
      cube = new THREE.Mesh(geo, mat);
      scene.add(cube);

      // Ground
      const ground = new THREE.Mesh(
        new THREE.PlaneGeometry(50, 50),
        new THREE.MeshStandardMaterial({ color: 0x123d22, roughness: 1 })
      );
      ground.rotation.x = -Math.PI/2;
      ground.position.y = -1;
      scene.add(ground);

      // Events
      window.addEventListener('resize', onResize, false);
      controls.addEventListener('lock', () => setStatus("Pointer locked. Press ESC to unlock."));
      controls.addEventListener('unlock', () => setStatus("Pointer unlocked. Click to lock."));

      // Kick off render loop
      animate();
    }

    function onResize() {
      if (!renderer || !camera) return;
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    }

    function animate() {
      requestAnimationFrame(animate);
      const dt = clock.getDelta();

      // demo spin (replace with your game loop)
      if (cube) cube.rotation.y += dt * 0.6;

      renderer.render(scene, camera);
    }

    /**************
     * Boot
     **************/
    window.addEventListener('load', () => {
      setStatus("Loading…");
      initializeFirebase(); // will gracefully skip if no config
    });
  </script>
</body>
</html>
